# 01. ES ìƒ‰ì¸ ì†ë„ ì¦ëŒ€ë¥¼ ìœ„í•œ EC2 ì¸ìŠ¤í„´ìŠ¤ íƒ€ì… ë³€ê²½, ê·¸ë¦¬ê³  iostat ëª…ë ¹ì–´ë¡œ ë””ìŠ¤í¬ I/O í™•ì¸í•˜ê¸°

> ìµœê·¼ì˜ AWS ìƒì— êµ¬ë™ë˜ê³  ìˆëŠ” ê²€ìƒ‰ ì—”ì§„ ì¸ë±ìŠ¤ ë…¸ë“œ(node-i: ìƒ‰ì¸ ì‹œ ì‚¬ìš©ë˜ëŠ” ë…¸ë“œ)ì˜ ì¸ìŠ¤í„´ìŠ¤ ìœ í˜•ì„ ë³€ê²½í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ìˆì—ˆë‹¤.  
> ê¸°ì¡´ c6g.8xlargeë¥¼ ì‚¬ìš©í•˜ë˜ EC2 ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…ì„ c6gd.8xlargeë¡œ ë³€ê²½í•´ì•¼ í–ˆë‹¤. ì´ìœ ëŠ” c6g.8xlargeì˜ ê²½ìš° EBS Onlyë¡œ EBSì˜ ê²½ìš° ë„¤íŠ¸ì›Œí¬ë¡œ ì—°ê²°ì´ ë˜ì–´ ìˆì§€ë§Œ
> ë‚´ì¥ ìŠ¤í† ë¦¬ì§€ë¥¼ ì‚¬ìš©í•˜ëŠ” c6gd.8xlarge ìœ í˜•ì„ ì‚¬ìš©í•˜ê¸°ì— ìƒ‰ì¸(ì¸ë±ì‹±) ì†ë„ë¥¼ ë†’íˆê¸°ì—ëŠ” ë‚´ì¥ ìŠ¤í† ë¦¬ì§€ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤ê³  íŒë‹¨í•˜ì˜€ë‹¤.

## 01-1. AWS EC2 ì¸ë±ì‹± ë…¸ë“œ êµ¬ì„±

![20240630_ì¸ë±ìŠ¤_í”„ë¡œì„¸ìŠ¤](./img/20240630_ì¸ë±ìŠ¤_í”„ë¡œì„¸ìŠ¤.png)

í˜„ì¬ í’€ ìƒ‰ì¸ì˜ ê²½ìš° íŠ¹ì • ì‹œê°„(ìƒˆë²½ 05:00)ì— Logstashê°€ êµ¬ë™ì´ ë˜ì–´ DBì˜ ê°’ì„ ì¡°íšŒ(í”„ë¡œì‹œì € ì‚¬ìš©)í•˜ì—¬ AWS EC2(index Node)ì— ë¨¼ì € ìƒ‰ì¸ì„ ì§„í–‰í•œë‹¤.  
í›„ì— ìƒ‰ì¸ì´ ëª¨ë‘ ì™„ë£Œë˜ë©´ box_type change(hot & warm) ì „ëµì„ í†µí•´ node.attr(index : ì¸ë±ìŠ¤ ë…¸ë“œ) -> node.attr(live : ë¼ì´ë¸Œ ì„œë¹„ìŠ¤ ë°ì´í„° ë…¸ë“œ) ìƒ¤ë”©ì„ ìˆ˜í–‰í•œë‹¤.  
ì´ ë•Œ, ë°ì´í„° ë…¸ë“œì˜ node.attrê°€ liveë¡œ ì„ ì–¸ì´ ë˜ì–´ ìˆê¸°ì— ëª¨ë“  ìƒ¤ë“œê°€ ë°ì´í„° ë…¸ë“œë¡œ ë¶„ë°°ê°€ ë˜ì–´ì§„ë‹¤.

## 01-2. c6g.8xlarge vs c6gd.8xlarge ì°¨ì´

- **c6g.8xlarge**: `ê³ ì† ë¡œì»¬ ìŠ¤í† ë¦¬ì§€`ê°€ í•„ìš”í•˜ì§€ ì•Šê³ , `ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•œ EBS ìŠ¤í† ë¦¬ì§€ê°€ ì¶©ë¶„`í•œ ê²½ìš° ì í•©
- **c6gd.8xlarge**: `ê³ ì† ë¡œì»¬ ìŠ¤í† ë¦¬ì§€`ê°€ í•„ìš”í•œ ì• í”Œë¦¬ì¼€ì´ì…˜, ì˜ˆë¥¼ ë“¤ì–´ `ìºì‹±`ì´ë‚˜ `ë¹ ë¥¸ ì„ì‹œ ì €ì¥ì†Œê°€ í•„ìš”í•œ ê²½ìš°`ì— `ì í•©`

| Feature                | c6g.8xlarge                     | c6gd.8xlarge                     | Desc                             |
|------------------------|---------------------------------|----------------------------------|----------------------------------|
| vCPUs                  | 32                              | 32                               | ë™ì¼í•œ ìˆ˜ì˜ ê°€ìƒ CPU            |
| Memory (GiB)           | 64                              | 64                               | ë™ì¼í•œ ë©”ëª¨ë¦¬ í¬ê¸°              |
| Instance Storage       | EBS-Only                        | 1 x 1900 NVMe SSD                | EBSë§Œ ì‚¬ìš© ê°€ëŠ¥ vs. NVMe SSD ì¶”ê°€|
| Network Bandwidth (Gbps)| 12                              | 12                               | ë™ì¼í•œ ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­          |
| EBS Bandwidth (Mbps)   | 9000                            | 9000                             | ë™ì¼í•œ EBS ëŒ€ì—­í­               |
| Enhanced Networking    | Yes                             | Yes                              | ë™ì¼í•œ í–¥ìƒëœ ë„¤íŠ¸ì›Œí‚¹ ì§€ì›     |
| Processor              | AWS Graviton2                   | AWS Graviton2                    | ë™ì¼í•œ í”„ë¡œì„¸ì„œ ì‚¬ìš©            |
| Price (On-Demand, Linux)| $1.0344 per hour               | $1.2288 per hour                 | c6gd.8xlargeê°€ ë” ë¹„ìŒˆ          |

> í•„ìì˜ ì„œë¹„ìŠ¤ì—ì„œ AWS ECS ì¸ë±ìŠ¤ ë…¸ë“œì˜ ì—­í• ì€ ì„ì‹œì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë“¤ê³  ìˆë‹¤ê°€, ê°ê°ì˜ ë°ì´í„° ë…¸ë“œë¡œ ìƒ¤ë“œë¥¼ ë¶„ë°°í•˜ëŠ” ì—­í• ì„ í•˜ëŠ” ì„œë²„ë‹¤.  
> ì´ ì„œë²„ëŠ” ì˜êµ¬ì ì¸ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ë˜ê¸°ì— ìƒ‰ì¸ ì†ë„ë¥¼ ë†’íˆê¸° ìœ„ì—ì„œëŠ” ë‚´ì¥ ìŠ¤í† ë¦¬ì§€ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤ëŠ” ìƒê°ì„ í•˜ì˜€ë‹¤.

- **c6g.8xlarge**
  - EBS(Elastic Block Store)ë§Œ ì‚¬ìš©í•˜ì—¬ ìŠ¤í† ë¦¬ì§€ë¥¼ ì œê³µ
  - EBSëŠ” ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì—°ê²°ëœ ìŠ¤í† ë¦¬ì§€ë¡œ, ë†’ì€ ì‹ ë¢°ì„±ê³¼ ìœ ì—°ì„± ì œê³µ
  - `í•˜ì§€ë§Œ ë‚´ì¥ ê³ ì† ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í¬í•¨ ì•ˆí•¨`
- **c6gd.8xlarge**
  - EBS ì™¸ì—ë„ `1 x 1900 NVMe SSD`ë¥¼ í¬í•¨
  - `NVMe SSD`ëŠ” ë§¤ìš° ë†’ì€ ì…ì¶œë ¥ ì†ë„ë¥¼ ì œê³µí•˜ëŠ” ë¡œì»¬ ìŠ¤í† ë¦¬ì§€
  - `ìºì‹œ`ë‚˜ `ì¼ì‹œì ì¸ ë°ì´í„° ì €ì¥ì†Œ`ë¡œ ë§¤ìš° ìœ ìš©í•©ë‹ˆë‹¤.
  - AWS EC2 ì¸ìŠ¤í„´ìŠ¤ c6gd.8xlargeì˜ ë¡œì»¬ NVMe SSDì˜ ê¸°ë³¸ IOPSì™€ ì“°ë£¨í’‹ ê°’
    - ê¸°ë³¸ IOPS(Input/Output Operations Per Second): `20,000 IOPS`
    - ê¸°ë³¸ ì“°ë£¨í’‹(Throughput): `1,187.5` MB/s

> ìƒ‰ì¸ í”„ë¡œì„¸ìŠ¤ì˜ í° ê·¸ë¦¼ì€ ìœ„ì™€ ê°™ì€ë°, AWS EC2ì˜ ì¸ìŠ¤í„´ìŠ¤ ìœ í˜•ì„ ë³€ê²½ í•œ í›„ ë‚˜ëŠ” ë§ˆìš´íŒ… ëœ DISK ì‚¬ìš©ëŸ‰ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³´ê³  ì‹¶ì—ˆë‹¤.  
> ì°¾ì•„ë³´ë˜ ì¤‘ iost ë€ Linux ëª…ë ¹ì–´ì— ëŒ€í•´ ì•Œê²Œ ë˜ì—ˆê³  ì‹¤ì‹œê°„ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” CPU, DISK IOì— ëŒ€í•œ í™•ì¸ì„ í•  ìˆ˜ ìˆì—ˆë‹¤.

## 01-2. iostat

- `iostat`ì€ `ë””ìŠ¤í¬ ì…ì¶œë ¥`(Disk I/O)ì— ëŒ€í•œ `í†µê³„`ë¥¼ ë³´ê³ í•œë‹¤
- Disk, CPU `ì²˜ë¦¬ëŸ‰`, `ì‚¬ìš©ë¥ `, `ëŒ€ê¸°ì—´ ê¸¸ì´`, `íŠ¸ëœì­ì…˜ ë¹„ìœ¨` ë° `ì„œë¹„ìŠ¤ ì‹œê°„`ì— ëŒ€í•œ ì¸¡ì • ê²°ê³¼ íšë“ ê°€ëŠ¥
- ì¦‰, CPUì™€ Disk Deviceì˜ input/output í†µê³„ ì •ë³´ í™•ì¸ ê°€ëŠ¥

```shell
yum install sysstat # ì„¼í† ìŠ¤ ì„¤ì¹˜
sudo apt install sysstat # ìš°ë¶€íˆ¬ ì„¤ì¹˜
```

í•„ìì˜ EC2 í™˜ê²½ì—ëŠ” sysstatì´ ìë™ìœ¼ë¡œ ì„¤ì¹˜ê°€ ë˜ì–´ ìˆì—ˆëŠ”ë°(ìë™ ì„¤ì¹˜ ì•„ë‹ ìˆ˜ ìˆìŒ) í˜¹ì‹œ ê¹”ë ¤ìˆì§€ ì•Šì€ ê²½ìš° ìœ„ ëª…ë ¹ì–´ë¥¼ í†µí•´ ì„¤ì¹˜í•˜ë©´ ëœë‹¤.

```shell
iostat [ì˜µì…˜] [ì¸í„°ë²Œ] [íšŸìˆ˜]
```

`iostat`ì˜ ì˜µì…˜ì—ëŠ” `ì¸í„°ë²Œ` ê·¸ë¦¬ê³  `íšŸìˆ˜`ê°€ ë‚˜ì˜¨ë‹¤. `ì¸í„°ë²Œ`ì€ ëª‡ì´ˆë§ˆë‹¤ ë””ìŠ¤í¬ ë””ë°”ì´ìŠ¤ ì •ë³´ë¥¼ ì¶œë ¥í• ì§€, `íšŸìˆ˜`ëŠ” ëª‡ë²ˆ ìˆ˜ì§‘ í•  ê²ƒì¸ì§€ ì§€ì •í•˜ëŠ” ëª…ë ¹ì–´ë‹¤.  
ì‹¤ì œ ëª…ë ¹ì–´ë¥¼ ì¹˜ê²Œ ë˜ë©´ ì•„ë˜ì™€ ê°™ì´ ê²°ê³¼ê°’ì´ ì¶œë ¥ì´ ëœë‹¤.

```shell
# 5ì´ˆë§ˆë‹¤ í™•ì¥ ì •ë³´ë¥¼ ì¶œë ¥í•´ë¼
iostat -x 5

# ì¶œë ¥ ê²°ê³¼
Linux 5.xxx.xxx-xxx.xxx.amzn2.aarch64 (xxx-xxx-xxx-d01)         06/30/2024      _aarch64_       (2 CPU)

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
          10.04    0.00    1.09    0.38    0.00   88.50

Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util
nvme0n1           0.00     0.42    0.01   19.24     0.50  1881.00   195.56     0.03    1.63    1.88    1.63   1.06   2.04
```

| Option   | Description                               |
|----------|-------------------------------------------|
| %user    | `CPU`ê°€ `User ëª¨ë“œ`ì—ì„œ ì‚¬ìš©ëœ ì‹œê°„ì˜ ë¹„ìœ¨ |
| %nice    | ì‘ì—… ìš°ì„ ìˆœìœ„ ì •ì±…ì— ì˜í•´ ìš°ì„ ìˆœìœ„ê°€ ë°”ë€ í”„ë¡œì„¸ìŠ¤ê°€ ì‚¬ìš©í•œ ì‹œê°„ì˜ ë¹„ìœ¨ |
| %system  | `CPU`ê°€ `System ëª¨ë“œ`ì—ì„œ ì‚¬ìš©ëœ ì‹œê°„ì˜ ë¹„ìœ¨ |
| %iowait  | `ë””ìŠ¤í¬ ì…ì¶œë ¥`ì„ `ê¸°ë‹¤ë¦¬ëŠ”ë°` ì‚¬ìš©ëœ ì‹œê°„ì˜ ë¹„ìœ¨ |
| %steal   | `ê°€ìƒí™” í™˜ê²½`ì—ì„œ `ê°€ìƒ CPU`ê°€ `ë‹¤ë¥¸ ê°€ìƒ ë¨¸ì‹  ì‘ì—… ê¸°ë‹¤ë¦¬ëŠë¼` ì‚¬ìš©ëœ ì‹œê°„ ë¹„ìœ¨ |
| %idle    | `CPU`ê°€ `ìœ íœ´ ìƒíƒœ`ë¡œ ìˆëŠ” ì‹œê°„ ë¹„ìœ¨, ì´ ê°’ì´ ë†’ì„ìˆ˜ë¡ CPUê°€ ëŒ€ë¶€ë¶„ ì‰¬ê³  ìˆìŒì„ ì˜ë¯¸ |

> TODO: ìœ„ ì˜µì…˜ ì¢€ ë” ë””í…Œì¼í•˜ê²Œ ì •ë¦¬, Device ìª½ ì •ë¦¬

## 99. ì°¸ê³  ìë£Œ

- [[LINUX] ğŸ“š ë””ìŠ¤í¬ ëª…ë ¹ì–´ ì •ë¦¬ (df / du / iostat)](https://inpa.tistory.com/entry/LINUX-%F0%9F%93%9A-%EB%94%94%EC%8A%A4%ED%81%AC-%EB%AA%85%EB%A0%B9%EC%96%B4-%EC%A0%95%EB%A6%AC-df-du-%EC%9A%A9%EB%9F%89-%EA%B5%AC%ED%95%98%EA%B8%B0)
- [[Linux] iostat ëª…ë ¹ì–´ ì‚¬ìš©ë²• - ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§](https://hbase.tistory.com/324)
- [[Linux] IO ë¶€í•˜ë¥¼ ì˜ˆì¸¡í•˜ëŠ” ëª…ë ¹ì–´ ë‘ê°€ì§€ iotop ì™€ iostat](https://devkingdom.tistory.com/233)
- [Linux iostat](https://brunch.co.kr/@lars/7)
