# 01. Elasticsearch ì¬ìƒ‰ì¸?

> ê¸°ì¡´ ê²€ìƒ‰ì—”ì§„ì„ ìš´ì˜í•˜ëŠ” ê³¼ì • ì¤‘ì— ë™ì˜ì–´ ê´€ë ¨ëœ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ í•µì‹¬ ë©”íƒ€ í…œí”Œë¦¿ì„ ìˆ˜ì •í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ë°œìƒí•˜ì˜€ë‹¤.  
> í•˜ì—¬ STG í™˜ê²½ì—ì„œ ê¸°ì¡´ì— ìƒì„±ì´ ë˜ì–´ìˆëŠ” 2300ë§Œê±´ ì •ë„ì˜ ë°ì´í„°ë¥¼ Logstash + DB í”„ë¡œì‹œì €ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒ‰ì¸í•˜ëŠ” ë°©ì‹ ëŒ€ì‹   
> reindex ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ë³µì‚¬í•˜ëŠ” ê³¼ì •ì„ ì ì–´ë³´ì•˜ë‹¤ ğŸ˜€

ìƒìš© ì„œë¹„ìŠ¤ì˜ ê²½ìš° í˜„ì¬ aliasë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤. i-nodeì— ì‹ ê·œ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•´ì„œ ì¸ë±ì‹±ì„ ìˆ˜í–‰í•˜ê³  í›„ì— í•´ë‹¹ ì¸ë±ìŠ¤ì˜  
python ë¡œì§ì—ì„œ routing.allocation.require.boxtype optionì„ index -> liveë¡œ ë³€ê²½í•œë‹¤.  
ì´ ë•Œ í”„ë¼ì´ë¨¸ë¦¬ ìƒ¤ë“œì˜ ì¸ë±ìŠ¤ê°€ sharding ë˜ì–´ replicaë¡œ ë¶„ë°°ê°€ ëœë‹¤.

## 01-1. reindex?

- Elasticsearchì—ì„œëŠ” ë³´ê¸°ë³´ë‹¤ reindexë¥¼ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ì¡´ì¬í•¨
    - ì¸ë±ìŠ¤ì˜ mapping, settings, ìƒ¤ë“œ ì„ ìˆ˜ì •í•´ì•¼ í•˜ëŠ” ê²½ìš°
        - í•œë²ˆ ìƒì„±ì´ ëœ mapping, settingsëŠ” ë³€ê²½ì´ ë„ˆë¬´ í˜ë“¤ë‹¤ ğŸ˜¶
    - ESë¥¼ ìµœì‹  ë²„ì „ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ í•´ì•¼í•˜ëŠ” ê²½ìš°
    - indexì˜ ì´ë¦„ ë³€ê²½ì´ í•„ìš”í•  ë•Œ â†’ ì´ ê²½ìš° ì£¼ë¡œ alias í™œìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš°
    - ìƒˆë¡œìš´ indexëª…ì— ìƒ‰ì¸ì„ í•˜ëŠ” ê²½ìš°ë„ ì¡´ì¬í•˜ê² ì§€ë§Œ ë°ì´í„°ê°€ í° ê²½ìš° ì‰½ì§€ëŠ” ì•ŠìŒ
- reindx
    - reindxë€ ë§ ê·¸ëŒ€ë¡œ ì¸ë±ì‹±ì„ ìƒˆë¡œ í•œë‹¤ëŠ” ì˜ë¯¸
    - **reindexëŠ” ë³µì‚¬ê°€ ì•„ë‹ˆë‹¤**. ì¦‰, reindexë¥¼ í•˜ë ¤ëŠ” indexì˜ mapping, settings ì •ë³´ê°€ ë˜‘ê°™ì´ ë³µì‚¬ë˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤.
    - ì¦‰, ë°ì´í„°ë§Œ ë„£ê¸° ë•Œë¬¸ì— default mappingìœ¼ë¡œ ì¸ë±ìŠ¤ê°€ ìƒì„±ì´ ë ê±°ê³  mapping, settingsì˜ ê²½ìš° ìˆ˜ì •ì„ í•´ì£¼ì–´ì•¼ í•œë‹¤
    - reindexì˜ ê²½ìš° ë°ì´í„°ê°€ ë§ì€ ìƒìš© í™˜ê²½ì—ì„œëŠ” ì‘ì—… ë¹„ìš©ì´ í¬ê¸°ì— ë§¤í•‘ ì •ë³´ë¥¼ ì• ì´ˆì— ì˜ ì„¤ì •í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤

## 01-2. í…œí”Œë¦¿ ìˆ˜ì • ì˜ˆì‹œ

> ì•„ë˜ ì˜ˆì‹œëŠ” íƒ€ ë¸”ë¡œê·¸ì˜ ê¸€ì—ì„œ ì‚¬ìš©ëœ ì˜ˆì‹œë¥¼ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤

```json
// ë³€ê²½ ì „ì˜ wedul_mapping í…œí”Œë¦¿
PUT wedul_mapping
{
  "mappings": {
    "_doc": {
      "dynamic": "false",
      "properties": {
        "id": {
          "type": "integer"
        },
        "name": {
          "type": "text",
          "fields": {
            "keyword": {
              "type": "keyword"
            }
          }
        }
      }
    }
  }
}
```

- ìœ„ í…œí”Œë¦¿ì—ì„œ name í•„ë“œì˜ keyword ë³µí•© í•„ë“œë¥¼ ì œê±°í•˜ê³  age ë¼ëŠ” Integer íƒ€ì…ì˜ í•„ë“œë¥¼ ë§¤í•‘í•˜ê³ ì í•œë‹¤

```json
// wedul_mapping_dump ë¼ëŠ” ì„ì‹œ í…œí”Œë¦¿ì„ ìƒì„±í•œë‹¤
PUT wedul_mapping_dump
{
  "mappings": {
    "_doc": {
      "dynamic": "false",
      "properties": {
        "id": {
          "type": "integer"
        },
        "name": {
          "type": "text"
        },
        "age": {
          "type": "integer"
        }
      }
    }
  }
}
```

- nameì€ ë‹¨ì¼ text íƒ€ì… í•„ë“œë¡œ, ageëŠ” Integer íƒ€ì…ì˜ í•„ë“œë¡œ ì„ ì–¸í•œë‹¤

## 01-3. _reindex ìˆ˜í–‰

```json
// local ì—ì„œ ê°€ì ¸ì˜¤ê¸°
POST _reindex
{
	"source": {
		"index": "ê°€ì ¸ì˜¬ ì¸ë±ìŠ¤ëª…"
	},
	"dest": {
		"index": "ì €ì¥í•  ì¸ë±ìŠ¤ëª…"
	}
}
```

```json
// remote ì—ì„œ ê°€ì ¸ì˜¤ê¸°
// ì•„ë˜ ëª…ë ¹ì–´ëŠ” ì‹¤ì œë¡œ í•´ë³´ì§€ëŠ” ì•Šì•˜ë‹¤
POST _reindex
{
    "source": {
        "remote": {
            "host": "http://remotehost:9200",
            "username": "user",
            "password": "pass"
        },
        "index": "old_index"
    },
    "dest": {
        "index": "new_index"
    }
}
```

```json
POST _reindex?wait_for_completion=false&slices=auto
{
  "source": {
    "index": "song-meta.2023-06-15",
    "size": 10000
  },
  "dest": {
    "index": "test-index"
  }
}
```

- wait_for_completion=false: **_reindex ì‘ì—…**ì„ **ë¹„ë™ê¸°ì **ìœ¼ë¡œ ìˆ˜í–‰
- slice=auto: **_reindex ì‘ì—…**ì„ **ë³‘ë ¬**ë¡œ ì‹¤í–‰í•˜ì—¬ ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•´ ì‚¬ìš©
- source: ë³µì‚¬ë¥¼ ìˆ˜í–‰í•  ëŒ€ìƒ ì¸ë±ìŠ¤
- size: ì¸ë±ìŠ¤ì—ì„œ ê°€ì ¸ì˜¬ ë¬¸ì„œì˜ ìµœëŒ€ ìˆ˜ë¥¼ ì§€ì •í•œë‹¤, 10,000 ì§€ì • ì‹œ í•œ ë²ˆì— 1ë§Œê°œì”©ë§Œ ê°€ì ¸ì™€ì„œ ë¬¸ì„œë¥¼ ì²˜ë¦¬í•¨
- desc: ìƒ‰ì¸ë  ëŒ€ìƒ ì¸ë±ìŠ¤ë¥¼ ì •ì˜
- index: ì¬ìƒ‰ì¸ëœ ë°ì´í„°ê°€ ì €ì¥ë  ìƒˆë¡œìš´ ì¸ë±ìŠ¤ ì´ë¦„

# 99. ì°¸ê³  ìë£Œ

- [ElasticSearch ì—ì„œ reindex ì„ í™œìš©í•˜ëŠ” ë°©ë²•](https://findstar.pe.kr/2018/07/07/elasticsearch-reindex/)
- [Elasticsearchì—ì„œ reindexë¥¼ ì´ìš©í•´ì„œ ë§¤í•‘ì •ë³´ ë³€ê²½í•˜ê¸°](https://wedul.site/611)
- [Elasticsearchì—ì„œ Reindex ì‚´í´ë³´ê¸°](https://yookeun.github.io/elasticsearch/2018/12/28/elastic-reindex/)